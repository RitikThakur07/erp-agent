<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Builder - AI-Powered ERP Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
    <style>
        .split-view {
            display: grid;
            grid-template-columns: 400px 1fr 1fr;
            height: calc(100vh - 64px);
            gap: 0;
        }
        
        .chat-panel {
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }
        
        .code-panel, .preview-panel {
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .chat-input {
            border-top: 1px solid #e5e7eb;
            padding: 1rem;
        }
        
        #editor {
            flex: 1;
            border: 1px solid #e5e7eb;
        }
        
        .file-tree {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 0.5rem;
        }
        
        .file-item {
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        
        .file-item:hover {
            background-color: #f3f4f6;
        }
        
        .message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        
        .message-user {
            background-color: #dbeafe;
            margin-left: 2rem;
        }
        
        .message-assistant {
            background-color: #f3f4f6;
            margin-right: 2rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold text-indigo-600">ERP Builder</h1>
                <span class="text-sm text-gray-500">AI-Powered ERP Generator</span>
            </div>
            
            <div class="flex items-center space-x-4">
                <select id="project-select" class="border rounded-md px-3 py-2">
                    <option value="">Select Project...</option>
                    {% for project in projects %}
                    <option value="{{ project.project_id }}">{{ project.name }}</option>
                    {% endfor %}
                </select>
                
                <button onclick="showNewProjectDialog()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">
                    + New Project
                </button>
            </div>
        </div>
    </header>

    <!-- Main Split View -->
    <div class="split-view">
        <!-- Left: Chat Panel -->
        <div class="chat-panel bg-white">
            <div class="p-4 border-b border-gray-200">
                <h2 class="font-bold text-lg">Project Manager Chat</h2>
                <p class="text-sm text-gray-500">Describe your ERP requirements</p>
            </div>
            
            <div id="chat-messages" class="chat-messages">
                <div class="message message-assistant">
                    <p class="text-sm">Hello! I'm your ERP Project Manager. I'll help you design and build a custom ERP system.</p>
                    <p class="text-sm mt-2">What kind of ERP system would you like to build? (e.g., Inventory Management, Sales, HR, Manufacturing)</p>
                </div>
            </div>
            
            <div class="chat-input">
                <form id="chat-form" onsubmit="sendMessage(event)">
                    <textarea 
                        id="chat-input" 
                        rows="3" 
                        class="w-full border rounded-md p-2 resize-none"
                        placeholder="Type your message..."
                    ></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <button type="button" onclick="uploadDocument()" class="text-sm text-indigo-600 hover:text-indigo-800">
                            ðŸ“Ž Upload Document
                        </button>
                        <div class="space-x-2">
                            <button type="button" onclick="generatePRD()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                Generate PRD
                            </button>
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-1 rounded hover:bg-indigo-700">
                                Send
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Middle: Code Panel -->
        <div class="code-panel bg-white border-r border-gray-200">
            <div class="p-4 border-b border-gray-200">
                <h2 class="font-bold text-lg mb-2">Code Editor</h2>
                
                <!-- File Tree -->
                <div id="file-tree" class="file-tree mb-4">
                    <p class="text-sm text-gray-500">Select a project to view files</p>
                </div>
                
                <!-- Current File -->
                <div class="flex justify-between items-center mb-2">
                    <span id="current-file" class="text-sm text-gray-600">No file selected</span>
                    <button onclick="saveFile()" class="text-sm bg-gray-200 px-2 py-1 rounded hover:bg-gray-300">
                        Save
                    </button>
                </div>
            </div>
            
            <!-- Monaco Editor -->
            <div id="editor"></div>
        </div>

        <!-- Right: Preview/Actions Panel -->
        <div class="preview-panel bg-gray-50">
            <div class="p-4 border-b border-gray-200 bg-white">
                <h2 class="font-bold text-lg mb-4">Actions & Preview</h2>
                
                <!-- Action Buttons -->
                <div class="space-y-2 mb-4">
                    <button onclick="generateBackend()" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400" id="btn-backend">
                        ðŸ”§ Generate Backend
                    </button>
                    <button onclick="generateFrontend()" class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 disabled:bg-gray-400" id="btn-frontend">
                        ðŸŽ¨ Generate Frontend
                    </button>
                    <button onclick="runQA()" class="w-full bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 disabled:bg-gray-400" id="btn-qa">
                        âœ“ Run QA Tests
                    </button>
                </div>
                
                <!-- Status -->
                <div id="status-panel" class="bg-gray-100 p-3 rounded text-sm">
                    <p class="font-medium">Status:</p>
                    <p id="status-text" class="text-gray-600">No project selected</p>
                </div>
            </div>
            
            <!-- Preview Frame -->
            <div class="p-4 flex-1">
                <div class="bg-white border rounded-lg h-full overflow-auto">
                    <iframe id="preview-frame" class="w-full h-full" src="about:blank"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- New Project Dialog (Hidden) -->
    <div id="new-project-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96">
            <h3 class="text-xl font-bold mb-4">Create New Project</h3>
            <form id="new-project-form" onsubmit="createProject(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Project Name</label>
                    <input type="text" id="project-name" required class="w-full border rounded-md px-3 py-2">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Description</label>
                    <textarea id="project-description" rows="3" class="w-full border rounded-md px-3 py-2"></textarea>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="hideNewProjectDialog()" class="px-4 py-2 border rounded-md hover:bg-gray-100">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                        Create
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
